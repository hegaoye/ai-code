<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">


<!-- 不使用namespace的话sql搜索定位会比较方便 -->
<mapper namespace="ClassroomVideo">

    <resultMap id="rs_base" type="ClassroomVideo">
        <result property="id" column="id"/>
        <result property="classroomCode" column="classroomCode"/>
        <result property="zoomRealId" column="zoomRealId"/>
        <result property="videoId" column="videoId"/>
        <result property="title" column="title"/>
        <result property="description" column="description"/>
        <result property="duration" column="duration"/>
        <result property="embeddedCode" column="embeddedCode"/>
        <result property="downloadUrl" column="downloadUrl"/>
        <result property="state" column="state"/>
        <result property="createTime" column="createTime"/>
        <result property="updateTime" column="updateTime"/>
    </resultMap>

    <!-- 用于select查询公用抽取的列 -->
    <sql id="ClassroomVideo.columns">
		id,classroomCode,zoomRealId,videoId,title,description,duration,embeddedCode,downloadUrl,state,createTime,updateTime
	</sql>

    <insert id="ClassroomVideo.insert" useGeneratedKeys="true" keyProperty="id" parameterType="ClassroomVideo">
        INSERT INTO classroom_video (
        id ,
        classroomCode ,
        zoomRealId ,
        videoId,
        title,
        description,
        duration,
        downloadUrl ,
        embeddedCode ,
        state ,
        createTime ,
        updateTime
        ) VALUES (
        #{id} ,
        #{classroomCode} ,
        #{zoomRealId} ,
        #{videoId},
        #{title},
        #{description},
        #{duration},
        #{downloadUrl} ,
        #{embeddedCode} ,
        #{state} ,
        #{createTime} ,
        #{updateTime}
        )
        <selectKey keyProperty="id" resultType="long">
            select LAST_INSERT_ID()
        </selectKey>
    </insert>

    <update id="ClassroomVideo.update" parameterType="ClassroomVideo">
        UPDATE classroom_video
        <trim prefix="set" suffixOverrides=",">
            <if test="zoomRealId!=null and zoomRealId!=''">
                zoomRealId = #{zoomRealId} ,
            </if>
            <if test="videoId!=null and videoId!=''">
                videoId = #{videoId} ,
            </if>
            <if test="title!=null and title!=''">
                title = #{title} ,
            </if>
            <if test="description!=null and description!=''">
                description = #{description} ,
            </if>
            <if test="duration!=null and duration!=''">
                duration = #{duration} ,
            </if>
            <if test="downloadUrl!=null and downloadUrl!=''">
                downloadUrl = #{downloadUrl} ,
            </if>
            <if test="embeddedCode!=null and embeddedCode!=''">
                embeddedCode = #{embeddedCode} ,
            </if>
            <if test="state!=null and state!=''">
                state = #{state} ,
            </if>
            <if test="updateTime!=null ">
                updateTime = #{updateTime}
            </if>
        </trim>

        <where>
            <if test="classroomCode!=null and classroomCode!=''">
                AND classroomCode = #{classroomCode}
            </if>
            <if test="zoomRealId!=null and zoomRealId!=''">
                AND zoomRealId = #{zoomRealId}
            </if>
            <if test="videoId!=null and videoId!=''">
                AND videoId = #{videoId}
            </if>
        </where>
	</update>

    <update id="ClassroomVideo.updateVideo" parameterType="ClassroomVideo">
        UPDATE classroom_video
        <trim prefix="set" suffixOverrides=",">
            <if test="zoomRealId!=null and zoomRealId!=''">
                zoomRealId = #{zoomRealId} ,
            </if>
            <if test="videoId!=null and videoId!=''">
                videoId = #{videoId} ,
            </if>
            <if test="title!=null and title!=''">
                title = #{title} ,
            </if>
            <if test="description!=null and description!=''">
                description = #{description} ,
            </if>
            <if test="duration!=null and duration!=''">
                duration = #{duration} ,
            </if>
            <if test="downloadUrl!=null and downloadUrl!=''">
                downloadUrl = #{downloadUrl} ,
            </if>
            <if test="embeddedCode!=null and embeddedCode!=''">
                embeddedCode = #{embeddedCode} ,
            </if>
            <if test="state!=null and state!=''">
                state = #{state} ,
            </if>
            <if test="updateTime!=null ">
                updateTime = #{updateTime}
            </if>
        </trim>

        <where>
            <if test="classroomCode!=null and classroomCode!=''">
                AND classroomCode = #{classroomCode}
            </if>
        </where>
	</update>

    <delete id="ClassroomVideo.delete">
        DELETE FROM classroom_video WHERE
        id = #{id}  AND 
        classroomCode = #{id} 
    </delete>

    <select id="ClassroomVideo.load" resultMap="rs_base">
        SELECT
        <include refid="ClassroomVideo.columns"/>
        FROM classroom_video
        WHERE
        classroomCode = #{classroomCode}
    </select>

    <sql id="ClassroomVideo.where">
        <where>
            <if test="id!=null and id!=''">
                AND id = #{id}
            </if>
            <if test="classroomCode!=null and classroomCode!=''">
                AND classroomCode = #{classroomCode}
            </if>
            <if test="zoomRealId!=null and zoomRealId!=''">
                AND zoomRealId = #{zoomRealId}
            </if>
            <if test="videoId!=null and videoId!=''">
                AND videoId = #{videoId}
            </if>
            <if test="title!=null and title!=''">
                AND title = #{title}
            </if>
            <if test="description!=null and description!=''">
                AND description = #{description}
            </if>
            <if test="duration!=null and duration!=''">
                AND duration = #{duration}
            </if>
            <if test="downloadUrl!=null and downloadUrl!=''">
                AND downloadUrl = #{downloadUrl}
            </if>
            <if test="embeddedCode!=null and embeddedCode!=''">
                AND embeddedCode = #{embeddedCode}
            </if>
            <if test="state!=null and state!=''">
                AND state = #{state}
            </if>
            <if test="states!=null">
                AND state in
                <foreach collection="states" item="state_in" index="index" open="(" close=")" separator=",">
                    #{state_in}
                </foreach>
            </if>
            <if test="createTimeBegin!=null ">
                AND createTime >= #{createTimeBegin}
            </if>
            <if test="createTimeEnd!=null ">
                AND createTime &lt;= #{createTimeEnd}
            </if>
            <if test="updateTimeBegin!=null ">
                AND updateTime >= #{updateTimeBegin}
            </if>
            <if test="updateTimeEnd!=null ">
                AND updateTime &lt;= #{updateTimeEnd}
            </if>
        </where>
    </sql>


    <select id="ClassroomVideo.count" resultType="int">
        SELECT count(1) FROM classroom_video
        <include refid="ClassroomVideo.where"/>
    </select>


    <select id="ClassroomVideo.query" resultMap="rs_base">
        SELECT
        <include refid="ClassroomVideo.columns"/>
        FROM classroom_video
        <include refid="ClassroomVideo.where"/>

        <if test="sortColumns!=null and sortColumns!=''">
            ORDER BY ${sortColumns}
        </if>
    </select>

    <!--查询一个视频记录-->
    <select id="ClassroomVideo.loadByClassroomCode" resultMap="rs_base">
        SELECT * FROM classroom_video  WHERE  classroomCode = #{classroomCode}
    </select>

</mapper>

