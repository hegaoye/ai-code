<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">


<!-- 不使用namespace的话sql搜索定位会比较方便 -->
<mapper namespace="Goods">

    <resultMap id="rs_base" type="Goods">
        <result property="id" column="id"/>
        <result property="goodsCode" column="goodsCode"/>
        <result property="goodsCategoryCode" column="goodsCategoryCode"/>
        <result property="goodsName" column="goodsName"/>
        <result property="ad" column="ad"/>
        <result property="courseHour" column="courseHour"/>
        <result property="courseHourType" column="courseHourType"/>
        <result property="timeZone" column="timeZone"/>
        <result property="validityPeriod" column="validityPeriod"/>
        <result property="validityPeriodStartTime" column="validityPeriodStartTime"/>
        <result property="validityPeriodEndTime" column="validityPeriodEndTime"/>
        <result property="goodsPrice" column="goodsPrice"/>
        <result property="promotionPrice" column="promotionPrice"/>
        <result property="promotionType" column="promotionType"/>
        <result property="saleNum" column="saleNum"/>
        <result property="favoriteNum" column="favoriteNum"/>
        <result property="mainImage" column="mainImage"/>
        <result property="state" column="state"/>
        <result property="audit" column="audit"/>
        <result property="createTime" column="createTime"/>
        <result property="updateTime" column="updateTime"/>
        <result property="isDrawBill" column="isDrawBill"/>
        <result property="rateLevel" column="rateLevel"/>
        <result property="rateNum" column="rateNum"/>
        <result property="isAllowRefundExpired" column="isAllowRefundExpired"/>
        <result property="isOrderGoods" column="isOrderGoods"/>
        <result property="isPreSaleGoods" column="isPreSaleGoods"/>
        <result property="isHaveGift" column="isHaveGift"/>
        <result property="vn" column="vn"/>
    </resultMap>


    <!--所有信息-->
    <resultMap id="rs_base_all" type="Goods" extends="rs_base">
        <association property="goodsCategory" column="{goodsCategoryCode=goodsCategoryCode}" select="GoodsCategory.load"/>
    </resultMap>

    <!-- 用于select查询公用抽取的列 -->
    <sql id="Goods.columns">
		id,goodsCode,goodsCategoryCode,goodsName,ad,courseHour,courseHourType,timeZone,validityPeriod,validityPeriodStartTime,validityPeriodEndTime,goodsPrice,promotionPrice,promotionType,saleNum,favoriteNum,mainImage,state,audit,createTime,updateTime,isDrawBill,rateLevel,rateNum,isAllowRefundExpired,isOrderGoods,isPreSaleGoods,isHaveGift,vn
	</sql>

    <insert id="Goods.insert" useGeneratedKeys="true" keyProperty="id" parameterType="Goods">
        INSERT INTO Goods (
        id ,
        goodsCode ,
        goodsCategoryCode ,
        goodsName ,
        ad ,
        courseHour ,
        courseHourType ,
        timeZone ,
        validityPeriod ,
        validityPeriodStartTime ,
        validityPeriodEndTime ,
        goodsPrice ,
        promotionPrice ,
        promotionType ,
        saleNum ,
        favoriteNum ,
        mainImage ,
        state ,
        audit ,
        createTime ,
        updateTime ,
        isDrawBill ,
        rateLevel ,
        rateNum ,
        isAllowRefundExpired ,
        isOrderGoods ,
        isPreSaleGoods ,
        isHaveGift ,
        vn
        ) VALUES (
        #{id} ,
        #{goodsCode} ,
        #{goodsCategoryCode} ,
        #{goodsName} ,
        #{ad} ,
        #{courseHour} ,
        #{courseHourType} ,
        #{timeZone} ,
        #{validityPeriod} ,
        #{validityPeriodStartTime} ,
        #{validityPeriodEndTime} ,
        #{goodsPrice} ,
        #{promotionPrice} ,
        #{promotionType} ,
        #{saleNum} ,
        #{favoriteNum} ,
        #{mainImage} ,
        #{state} ,
        #{audit} ,
        #{createTime} ,
        #{updateTime} ,
        #{isDrawBill} ,
        #{rateLevel} ,
        #{rateNum} ,
        #{isAllowRefundExpired} ,
        #{isOrderGoods} ,
        #{isPreSaleGoods} ,
        #{isHaveGift} ,
        #{vn}
        )
        <selectKey keyProperty="id" resultType="long">
            select LAST_INSERT_ID()
        </selectKey>
    </insert>

    <update id="Goods.update" parameterType="Goods">
        UPDATE Goods
        <trim prefix="set" suffixOverrides=",">
            <if test="goodsCategoryCode!=null and goodsCategoryCode!=''">
                goodsCategoryCode = #{goodsCategoryCode} ,
            </if>
            <if test="goodsName!=null and goodsName!=''">
                goodsName = #{goodsName} ,
            </if>
            <if test="ad!=null and ad!=''">
                ad = #{ad} ,
            </if>
            <if test="courseHour!=null ">
                courseHour = #{courseHour} ,
            </if>
            <if test="courseHourType!=null and courseHourType!=''">
                courseHourType = #{courseHourType} ,
            </if>
            <if test="timeZone!=null and timeZone!=''">
                timeZone = #{timeZone} ,
            </if>
            <if test="validityPeriod!=null and validityPeriod!=''">
                validityPeriod = #{validityPeriod} ,
            </if>
            <if test="validityPeriodStartTime!=null">
                validityPeriodStartTime = #{validityPeriodStartTime} ,
            </if>
            <if test="validityPeriodEndTime!=null ">
                validityPeriodEndTime = #{validityPeriodEndTime} ,
            </if>
            <if test="goodsPrice!=null and goodsPrice!=''">
                goodsPrice = #{goodsPrice} ,
            </if>
            <if test="promotionPrice!=null and promotionPrice!=''">
                promotionPrice = #{promotionPrice} ,
            </if>
            <if test="promotionType!=null and promotionType!=''">
                promotionType = #{promotionType} ,
            </if>
            <if test="saleNum!=null and saleNum!=''">
                saleNum = #{saleNum} ,
            </if>
            <if test="favoriteNum!=null and favoriteNum!=''">
                favoriteNum = #{favoriteNum} ,
            </if>
            <if test="mainImage!=null and mainImage!=''">
                mainImage = #{mainImage} ,
            </if>
            <if test="state!=null and state!=''">
                state = #{state} ,
            </if>
            <if test="audit!=null and audit!=''">
                audit = #{audit} ,
            </if>
            <if test="createTime!=null ">
                createTime = #{createTime} ,
            </if>
            <if test="updateTime!=null ">
                updateTime = #{updateTime} ,
            </if>
            <if test="isDrawBill!=null and isDrawBill!=''">
                isDrawBill = #{isDrawBill} ,
            </if>
            <if test="rateLevel!=null and rateLevel!=''">
                rateLevel = #{rateLevel} ,
            </if>
            <if test="rateNum!=null and rateNum!=''">
                rateNum = #{rateNum} ,
            </if>
            <if test="isAllowRefundExpired!=null and isAllowRefundExpired!=''">
                isAllowRefundExpired = #{isAllowRefundExpired} ,
            </if>
            <if test="isOrderGoods!=null and isOrderGoods!=''">
                isOrderGoods = #{isOrderGoods} ,
            </if>
            <if test="isPreSaleGoods!=null and isPreSaleGoods!=''">
                isPreSaleGoods = #{isPreSaleGoods} ,
            </if>
            <if test="isHaveGift!=null and isHaveGift!=''">
                isHaveGift = #{isHaveGift} ,
            </if>
            <if test="vn!=null and vn!=''">
                vn = #{vn}
            </if>
        </trim>
        WHERE
        goodsCode = #{goodsCode}
    </update>

    <delete id="Goods.delete">
        DELETE FROM Goods WHERE
        goodsCode = #{goodsCode}
    </delete>

    <select id="Goods.load" resultMap="rs_base">
        SELECT
        <include refid="Goods.columns"/>
        FROM Goods
        <include refid="Goods.where"/>
    </select>

    <sql id="Goods.where">
        <where>
            <if test="id!=null and id!=''">
                AND id = #{id}
            </if>
            <if test="goodsCode!=null and goodsCode!=''">
                AND goodsCode = #{goodsCode}
            </if>
            <if test="goodsCategoryCode!=null and goodsCategoryCode!=''">
                AND goodsCategoryCode = #{goodsCategoryCode}
            </if>
            <if test="goodsName!=null and goodsName!=''">
                AND goodsName = #{goodsName}
            </if>
            <if test="ad!=null and ad!=''">
                AND ad = #{ad}
            </if>
            <if test="courseHour!=null ">
                AND courseHour = #{courseHour}
            </if>
            <if test="courseHourType!=null and courseHourType!=''">
                AND courseHourType = #{courseHourType}
            </if>
            <if test="timeZone!=null and timeZone!=''">
                AND timeZone = #{timeZone}
            </if>
            <if test="validityPeriod!=null and validityPeriod!=''">
                AND validityPeriod = #{validityPeriod}
            </if>
            <if test="validityPeriodStartTimeBegin!=null ">
                AND validityPeriodStartTime >= #{validityPeriodStartTimeBegin}
            </if>
            <if test="validityPeriodStartTimeEnd!=null ">
                AND validityPeriodStartTime &lt;= #{validityPeriodStartTimeEnd}
            </if>
            <if test="validityPeriodEndTimeBegin!=null ">
                AND validityPeriodEndTime >= #{validityPeriodEndTimeBegin}
            </if>
            <if test="validityPeriodEndTimeEnd!=null ">
                AND validityPeriodEndTime &lt;= #{validityPeriodEndTimeEnd}
            </if>
            <if test="goodsPrice!=null and goodsPrice!=''">
                AND goodsPrice = #{goodsPrice}
            </if>
            <if test="promotionPrice!=null and promotionPrice!=''">
                AND promotionPrice = #{promotionPrice}
            </if>
            <if test="promotionType!=null and promotionType!=''">
                AND promotionType = #{promotionType}
            </if>
            <if test="saleNum!=null and saleNum!=''">
                AND saleNum = #{saleNum}
            </if>
            <if test="favoriteNum!=null and favoriteNum!=''">
                AND favoriteNum = #{favoriteNum}
            </if>
            <if test="mainImage!=null and mainImage!=''">
                AND mainImage = #{mainImage}
            </if>
            <if test="state!=null and state!=''">
                AND state = #{state}
            </if>
            <if test="audit!=null and audit!=''">
                AND audit = #{audit}
            </if>
            <if test="createTimeBegin!=null ">
                AND createTime >= #{createTimeBegin}
            </if>
            <if test="createTimeEnd!=null ">
                AND createTime &lt;= #{createTimeEnd}
            </if>
            <if test="updateTimeBegin!=null ">
                AND updateTime >= #{updateTimeBegin}
            </if>
            <if test="updateTimeEnd!=null ">
                AND updateTime &lt;= #{updateTimeEnd}
            </if>
            <if test="isDrawBill!=null and isDrawBill!=''">
                AND isDrawBill = #{isDrawBill}
            </if>
            <if test="rateLevel!=null and rateLevel!=''">
                AND rateLevel = #{rateLevel}
            </if>
            <if test="rateNum!=null and rateNum!=''">
                AND rateNum = #{rateNum}
            </if>
            <if test="isAllowRefundExpired!=null and isAllowRefundExpired!=''">
                AND isAllowRefundExpired = #{isAllowRefundExpired}
            </if>
            <if test="isOrderGoods!=null and isOrderGoods!=''">
                AND isOrderGoods = #{isOrderGoods}
            </if>
            <if test="isPreSaleGoods!=null and isPreSaleGoods!=''">
                AND isPreSaleGoods = #{isPreSaleGoods}
            </if>
            <if test="isHaveGift!=null and isHaveGift!=''">
                AND isHaveGift = #{isHaveGift}
            </if>
            <if test="vn!=null and vn!=''">
                AND vn = #{vn}
            </if>
        </where>
    </sql>


    <select id="Goods.count" resultType="long">
        SELECT count(1) FROM Goods
        <include refid="Goods.where"/>
    </select>


    <select id="Goods.query" resultMap="rs_base">
        SELECT
        <include refid="Goods.columns"/>
        FROM Goods
        <include refid="Goods.where"/>
        ORDER BY goodsCode DESC
    </select>


    <!--更新商品的图片信息-->
    <update id="Goods.update4Images" parameterType="Goods">
		UPDATE Goods SET
		mainImage = #{mainImage} ,
		updateTime = #{updateTime} ,
		vn = vn+1
		WHERE
		goodsCode = #{goodsCode}
		AND  vn = #{vn}
	</update>

    <!--查询课时商品列表-->
    <select id="Goods.listGoods" resultMap="rs_base">
        SELECT
        <include refid="Goods.columns"/>
        FROM Goods
        <include refid="Goods.listWhere"/>
        ORDER BY goodsCode DESC
    </select>

    <select id="Goods.countGoods" resultType="int">
        SELECT count(1) FROM Goods
        <include refid="Goods.listWhere"/>
    </select>


    <sql id="Goods.listWhere">
        <where>
            <if test="goodsCategoryCode!=null and goodsCategoryCode!=''">
                AND goodsCategoryCode = #{goodsCategoryCode}
            </if>
            <if test="promotionType!=null and promotionType!=''">
                AND promotionType = #{promotionType}
            </if>
            <if test="state!=null and state!=''">
                AND state = #{state}
            </if>
            <if test="audit!=null and audit!=''">
                AND audit = #{audit}
            </if>
            <if test="createTimeBegin!=null ">
                AND createTime >= #{createTimeBegin}
            </if>
            <if test="createTimeEnd!=null ">
                AND createTime &lt;= #{createTimeEnd}
            </if>
            <if test="isDrawBill!=null and isDrawBill!=''">
                AND isDrawBill = #{isDrawBill}
            </if>
            <if test="isAllowRefundExpired!=null and isAllowRefundExpired!=''">
                AND isAllowRefundExpired = #{isAllowRefundExpired}
            </if>
            <if test="isOrderGoods!=null and isOrderGoods!=''">
                AND isOrderGoods = #{isOrderGoods}
            </if>
            <if test="isPreSaleGoods!=null and isPreSaleGoods!=''">
                AND isPreSaleGoods = #{isPreSaleGoods}
            </if>
            <if test="isHaveGift!=null and isHaveGift!=''">
                AND isHaveGift = #{isHaveGift}
            </if>
        </where>
    </sql>

    <!--查询一个课时商品详情+商品分类-->
    <select id="Goods.loadAll" resultMap="rs_base_all">
        SELECT
        <include refid="Goods.columns"/>
        FROM Goods
        WHERE
        goodsCode = #{goodsCode}
    </select>

</mapper>

