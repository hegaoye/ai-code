<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">


<!-- 不使用namespace的话sql搜索定位会比较方便 -->
<mapper namespace="CourseWare">

    <resultMap id="rs_base" type="CourseWare">
        <result property="id" column="id"/>
        <result property="categoryCode" column="categoryCode"/>
        <result property="coursewareCode" column="coursewareCode"/>
        <result property="title" column="title"/>
        <result property="summary" column="summary"/>
        <result property="downloadUrl" column="downloadUrl"/>
        <result property="type" column="type"/>
        <result property="size" column="size"/>
        <result property="createTime" column="createTime"/>
        <result property="updateTime" column="updateTime"/>
        <result property="state" column="state"/>
        <result property="vn" column="vn"/>
        <result property="optName" column="optName"/>
        <result property="optCode" column="optCode"/>
    </resultMap>

    <!-- 用于select查询公用抽取的列 -->
    <sql id="CourseWare.columns">
		id,categoryCode,coursewareCode,title,summary,downloadUrl,type,size,createTime,updateTime,state,vn,optName,optCode
	</sql>

    <insert id="CourseWare.insert" useGeneratedKeys="true" keyProperty="id" parameterType="CourseWare">
        INSERT INTO `course_ware` (
        id ,
        categoryCode ,
        coursewareCode ,
        title ,
        summary ,
        downloadUrl ,
        type ,
        size ,
        createTime ,
        updateTime ,
        state ,
        vn ,
        optName ,
        optCode
        ) VALUES (
        #{id} ,
        #{categoryCode} ,
        #{coursewareCode} ,
        #{title} ,
        #{summary} ,
        #{downloadUrl} ,
        #{type} ,
        #{size} ,
        #{createTime} ,
        #{updateTime} ,
        #{state} ,
        #{vn} ,
        #{optName} ,
        #{optCode}
        )
        <selectKey keyProperty="id" resultType="long">
            select LAST_INSERT_ID()
        </selectKey>
    </insert>

    <update id="CourseWare.update" parameterType="CourseWare">
        UPDATE `course_ware`
        <trim prefix="set" suffixOverrides=",">
            <if test="categoryCode!=null and categoryCode!=''">
                categoryCode = #{categoryCode} ,
            </if>
            <if test="coursewareCode!=null and coursewareCode!=''">
                coursewareCode = #{coursewareCode} ,
            </if>
            <if test="title!=null and title!=''">
                title = #{title} ,
            </if>
            <if test="summary!=null and summary!=''">
                summary = #{summary} ,
            </if>
            <if test="downloadUrl!=null and downloadUrl!=''">
                downloadUrl = #{downloadUrl} ,
            </if>
            <if test="type!=null and type!=''">
                type = #{type} ,
            </if>
            <if test="size!=null and size!=''">
                size = #{size} ,
            </if>
            <if test="updateTime!=null ">
                updateTime = #{updateTime} ,
            </if>
            <if test="state!=null and state!=''">
                state = #{state} ,
            </if>
            <if test="vn!=null and vn!=''">
                vn = vn+1 ,
            </if>
            <if test="optName!=null and optName!=''">
                optName = #{optName} ,
            </if>
            <if test="optCode!=null and optCode!=''">
                optCode = #{optCode}
            </if>
        </trim>
        <where>
            <if test="coursewareCode!=null and coursewareCode!=''">
                AND coursewareCode = #{coursewareCode}
            </if>
            <if test="type!=null and type!=''">
                AND type = #{type}
            </if>

            <if test="state!=null and state!=''">
                AND state = #{state}
            </if>
            <if test="vn!=null and vn!=''">
                AND vn = #{vn}
            </if>
        </where>

    </update>

    <delete id="CourseWare.delete">
        DELETE FROM `course_ware`
        <include refid="CourseWare.where"/>
    </delete>

    <select id="CourseWare.load" resultMap="rs_base">
        SELECT
        <include refid="CourseWare.columns"/>
        FROM `course_ware`
        <include refid="CourseWare.where"/>
    </select>

    <sql id="CourseWare.where">
        <where>
            <if test="id!=null and id!=''">
                AND id = #{id}
            </if>
            <if test="categoryCode!=null and categoryCode!=''">
                AND categoryCode = #{categoryCode}
            </if>
            <if test="coursewareCode!=null and coursewareCode!=''">
                AND coursewareCode = #{coursewareCode}
            </if>
            <if test="title!=null and title!=''">
                AND title = #{title}
            </if>
            <if test="summary!=null and summary!=''">
                AND summary = #{summary}
            </if>
            <if test="downloadUrl!=null and downloadUrl!=''">
                AND downloadUrl = #{downloadUrl}
            </if>
            <if test="type!=null and type!=''">
                AND type = #{type}
            </if>
            <if test="size!=null and size!=''">
                AND size = #{size}
            </if>
            <if test="createTimeBegin!=null and createTimeBegin!=''">
                AND createTime >= #{createTimeBegin}
            </if>
            <if test="createTimeEnd!=null and createTimeEnd!=''">
                AND createTime &lt;= #{createTimeEnd}
            </if>
            <if test="updateTimeBegin!=null and updateTimeBegin!=''">
                AND updateTime >= #{updateTimeBegin}
            </if>
            <if test="updateTimeEnd!=null and updateTimeEnd!=''">
                AND updateTime &lt;= #{updateTimeEnd}
            </if>
            <if test="state!=null and state!=''">
                AND state = #{state}
            </if>
            <if test="vn!=null and vn!=''">
                AND vn = #{vn}
            </if>
            <if test="optName!=null and optName!=''">
                AND optName = #{optName}
            </if>
            <if test="optCode!=null and optCode!=''">
                AND optCode = #{optCode}
            </if>
        </where>
    </sql>


    <select id="CourseWare.count" resultType="long">
        SELECT count(*) FROM `course_ware`
        <include refid="CourseWare.where"/>
    </select>


    <select id="CourseWare.query" resultMap="rs_base">
        SELECT
        <include refid="CourseWare.columns"/>
        FROM `course_ware`
        <include refid="CourseWare.where"/>
        ORDER BY coursewareCode DESC
    </select>


</mapper>

