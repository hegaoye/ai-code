<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
                "http://mybatis.org/dtd/mybatis-3-mapper.dtd">


<!-- 不使用namespace的话sql搜索定位会比较方便 -->
<mapper namespace="DisplayAttribute">

    <resultMap id="rs_base" type="DisplayAttribute">
        <result property="id" column="id"/>
        <result property="mapFieldColumnCode" column="mapFieldColumnCode"/>
        <result property="isRequired" column="isRequired"/>
        <result property="isAllowUpdate" column="isAllowUpdate"/>
        <result property="isListPageDisplay" column="isListPageDisplay"/>
        <result property="isDetailPageDisplay" column="isDetailPageDisplay"/>
        <result property="isQueryRequired" column="isQueryRequired"/>
        <result property="displayType" column="displayType"/>
    </resultMap>

     <!-- 用于select查询公用抽取的列 -->
     <sql id="columns">
        id,mapFieldColumnCode,isRequired,isAllowUpdate,isListPageDisplay,isDetailPageDisplay,isQueryRequired,displayType
     </sql>

    <!--全局where条件-->
     <sql id="where">
      <where>
        <if test="id!=null and id!=''">
            AND id = #{id}
        </if>
        <if test="mapFieldColumnCode!=null and mapFieldColumnCode!=''">
            AND mapFieldColumnCode = #{mapFieldColumnCode}
        </if>
        <if test="isRequired!=null and isRequired!=''">
            AND isRequired = #{isRequired}
        </if>
        <if test="isAllowUpdate!=null and isAllowUpdate!=''">
            AND isAllowUpdate = #{isAllowUpdate}
        </if>
        <if test="isListPageDisplay!=null and isListPageDisplay!=''">
            AND isListPageDisplay = #{isListPageDisplay}
        </if>
        <if test="isDetailPageDisplay!=null and isDetailPageDisplay!=''">
            AND isDetailPageDisplay = #{isDetailPageDisplay}
        </if>
        <if test="isQueryRequired!=null and isQueryRequired!=''">
            AND isQueryRequired = #{isQueryRequired}
        </if>
        <if test="displayType!=null and displayType!=''">
            AND displayType = #{displayType}
        </if>
      </where>
     </sql>

    <!--向display_attribute插入一条数据-->
     <insert id="insert" useGeneratedKeys="true" keyProperty="id" parameterType="DisplayAttribute">
       INSERT INTO `display_attribute` (
        id ,
        mapFieldColumnCode ,
        isRequired ,
        isAllowUpdate ,
        isListPageDisplay ,
        isDetailPageDisplay ,
        isQueryRequired ,
        displayType 
        ) VALUES (
         #{id} ,
         #{mapFieldColumnCode} ,
         #{isRequired} ,
         #{isAllowUpdate} ,
         #{isListPageDisplay} ,
         #{isDetailPageDisplay} ,
         #{isQueryRequired} ,
         #{displayType} 
        )
      <selectKey keyProperty="id" resultType="long">
      select LAST_INSERT_ID()
      </selectKey>
     </insert>

    <!--根据任意条件删除display_attribute信息-->
    <delete id="delete">
      DELETE FROM `display_attribute`
      <include refid="where"/>
    </delete>

    <!--根据主键联合更新 display_attribute 的数据-->
     <update id="update" parameterType="DisplayAttribute">
        UPDATE `display_attribute`
        <trim prefix="set" suffixOverrides=",">
            <if test="isRequired!=null and isRequired!=''">
               isRequired = #{isRequired} ,
            </if>
            <if test="isAllowUpdate!=null and isAllowUpdate!=''">
               isAllowUpdate = #{isAllowUpdate} ,
            </if>
            <if test="isListPageDisplay!=null and isListPageDisplay!=''">
               isListPageDisplay = #{isListPageDisplay} ,
            </if>
            <if test="isDetailPageDisplay!=null and isDetailPageDisplay!=''">
               isDetailPageDisplay = #{isDetailPageDisplay} ,
            </if>
            <if test="isQueryRequired!=null and isQueryRequired!=''">
               isQueryRequired = #{isQueryRequired} ,
            </if>
            <if test="displayType!=null and displayType!=''">
               displayType = #{displayType} 
            </if>
        </trim>
        <where>
          <if test="id!=null and id!=''">
             AND id = #{id}
          </if>
          <if test="mapFieldColumnCode!=null and mapFieldColumnCode!=''">
             AND mapFieldColumnCode = #{mapFieldColumnCode}
          </if>
        </where>

     </update>

     <!--根据任何条件加载一条display_attribute的数据-->
     <select id="load" resultMap="rs_base">
       SELECT <include refid="columns" />
       FROM `display_attribute`
       where id = #{id}
     </select>

    <select id="count" resultType="long">
        SELECT count(*) FROM `display_attribute`
        <include refid="where"/>
    </select>


    <select id="query" resultMap="rs_base">
        SELECT
        <include refid="columns"/>
        FROM `display_attribute`
        <include refid="where"/>

        <if test="sortColumns!=null and sortColumns!=''">
            ORDER BY ${sortColumns}
        </if>
    </select>

</mapper>
