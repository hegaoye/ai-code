<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">


<!-- 不使用namespace的话sql搜索定位会比较方便 -->
<mapper namespace="QrtzJobDetails">

    <resultMap id="QrtzJobDetails" type="QrtzJobDetails">
        <result property="schedName" column="SCHED_NAME"/>
        <result property="jobName" column="JOB_NAME"/>
        <result property="jobGroup" column="JOB_GROUP"/>
        <result property="description" column="DESCRIPTION"/>
        <result property="jobClassName" column="JOB_CLASS_NAME"/>
        <result property="isDurable" column="IS_DURABLE"/>
        <result property="isNonconcurrent" column="IS_NONCONCURRENT"/>
        <result property="isUpdateData" column="IS_UPDATE_DATA"/>
        <result property="requestsRecovery" column="REQUESTS_RECOVERY"/>
        <result property="jobData" column="JOB_DATA"/>
    </resultMap>

    <!-- 用于select查询公用抽取的列 -->
    <sql id="columns">
	    <![CDATA[



		SCHED_NAME,JOB_NAME,JOB_GROUP,DESCRIPTION,JOB_CLASS_NAME,IS_DURABLE,IS_NONCONCURRENT,IS_UPDATE_DATA,REQUESTS_RECOVERY,JOB_DATA



        ]]>
	</sql>

    <insert id="insert" useGeneratedKeys="true" keyProperty="schedName" parameterType="QrtzJobDetails">
        INSERT INTO qrtz_job_details (
        SCHED_NAME ,
        JOB_NAME ,
        JOB_GROUP ,
        DESCRIPTION ,
        JOB_CLASS_NAME ,
        IS_DURABLE ,
        IS_NONCONCURRENT ,
        IS_UPDATE_DATA ,
        REQUESTS_RECOVERY ,
        JOB_DATA
        ) VALUES (
        #{schedName} ,
        #{jobName} ,
        #{jobGroup} ,
        #{description} ,
        #{jobClassName} ,
        #{isDurable} ,
        #{isNonconcurrent} ,
        #{isUpdateData} ,
        #{requestsRecovery} ,
        #{jobData}
        )
        <selectKey keyProperty="id" resultType="long">
            select LAST_INSERT_ID()
        </selectKey>
    </insert>

    <update id="update" parameterType="QrtzJobDetails">
    <![CDATA[



        UPDATE qrtz_job_details SET
	        DESCRIPTION = #{description} ,
	        JOB_CLASS_NAME = #{jobClassName} ,
	        IS_DURABLE = #{isDurable} ,
	        IS_NONCONCURRENT = #{isNonconcurrent} ,
	        IS_UPDATE_DATA = #{isUpdateData} ,
	        REQUESTS_RECOVERY = #{requestsRecovery} ,
	        JOB_DATA = #{jobData} 
        WHERE 
	        SCHED_NAME = #{schedName}  AND 
	        JOB_NAME = #{jobName}  AND 
	        JOB_GROUP = #{jobGroup} 



        ]]>
	</update>

    <delete id="delete">
    <![CDATA[



        DELETE FROM qrtz_job_details WHERE
        SCHED_NAME = #{id}  AND 
        JOB_NAME = #{id}  AND 
        JOB_GROUP = #{id} 



        ]]>
    </delete>

    <select id="load" resultMap="QrtzJobDetails">
        SELECT
        <include refid="columns"/>
        <![CDATA[
		    FROM qrtz_job_details 
	        WHERE 
		        SCHED_NAME = #{id}  AND 
		        JOB_NAME = #{id}  AND 
		        JOB_GROUP = #{id} 
	    ]]>
    </select>

    <sql id="where">
        <where>
            <if test="@Ognl@isNotEmpty(schedName)">
                AND SCHED_NAME = #{schedName}
            </if>
            <if test="@Ognl@isNotEmpty(jobName)">
                AND JOB_NAME = #{jobName}
            </if>
            <if test="@Ognl@isNotEmpty(jobGroup)">
                AND JOB_GROUP = #{jobGroup}
            </if>
            <if test="@Ognl@isNotEmpty(description)">
                AND DESCRIPTION = #{description}
            </if>
            <if test="@Ognl@isNotEmpty(jobClassName)">
                AND JOB_CLASS_NAME = #{jobClassName}
            </if>
            <if test="@Ognl@isNotEmpty(isDurable)">
                AND IS_DURABLE = #{isDurable}
            </if>
            <if test="@Ognl@isNotEmpty(isNonconcurrent)">
                AND IS_NONCONCURRENT = #{isNonconcurrent}
            </if>
            <if test="@Ognl@isNotEmpty(isUpdateData)">
                AND IS_UPDATE_DATA = #{isUpdateData}
            </if>
            <if test="@Ognl@isNotEmpty(requestsRecovery)">
                AND REQUESTS_RECOVERY = #{requestsRecovery}
            </if>
            <if test="@Ognl@isNotEmpty(jobData)">
                AND JOB_DATA = #{jobData}
            </if>
        </where>
    </sql>


    <select id="count" resultType="long">
        SELECT count(1) FROM qrtz_job_details
        <include refid="where"/>
    </select>


    <select id="query" resultMap="QrtzJobDetails">
        SELECT
        <include refid="columns"/>
        FROM qrtz_job_details
        <include refid="where"/>

        <if test="@Ognl@isNotEmpty(sortColumns)">
            ORDER BY ${sortColumns}
        </if>
    </select>


    <!--查询作业信息集合-->
    <select id="listJobDetails" resultMap="QrtzJobDetails">
		SELECT * FROM qrtz_job_details limit 100
	</select>
    <select id="countJobDetails" resultType="int">
		SELECT COUNT(1) FROM qrtz_job_details
	</select>

    <!--查询作业信息-->
    <select id="loadJobDetail" parameterType="String" resultMap="QrtzJobDetails">
		SELECT * FROM qrtz_job_details where jobName=#{value}
	</select>

</mapper>

